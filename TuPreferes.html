<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BattleZone</title>
</head>
<body>

    <h1> Bienvenue sur la zone de Battle !!!</h1>

    <h2>
        Ici vous ferez vous affrontez vos goûts musicaux avec ceux des autres afin d'établir la TIERLISTE ULTIME !!! <br>
        Cliquez sur l'une ou l'autre des images pour valider votre choix, et avancez jusqu'à la finale ! <br>
        Que la fête COMMENCE ! 
    </h2>

    <div id="BattleZone">

        <div id="Musique1">
            <h3 id="titre1"></h3>
            <img src="/" alt="" id="CoverMusique1">
        </div>

        <div id="Musique2">
            <h3 id="titre2"></h3>
            <img src="/" alt="" id="CoverMusique2">
        </div>
        
    </div>

</body>

<style>
    body, html {
        margin: 0;
        padding: 0;
    }

    img {
        border: solid black 3px;
        width: 400px;
        height: 400px;
        margin: 10px;
    }
</style>

<script>
const MUSIQUES = [
    { titre: "Musique 1/Rose", couverture: "placeholder/rose.png", points: 0 },
    { titre: "Musique 2/Bleu", couverture: "placeholder/bleu.png", points: 0 },
    { titre: "Musique 3/Fushia", couverture: "placeholder/fushia.png", points: 0 },
    { titre: "Musique 4/Sable", couverture: "placeholder/sable.png", points: 0 },
    { titre: "Musique 5/Marron", couverture: "placeholder/marron.png", points: 0 },
    { titre: "Musique 6/Orange", couverture: "placeholder/orange.png", points: 0 }
];

let Round = [...MUSIQUES];
let ProchainRound = [];
let Historique = [];

//-----------------------------------------------// FONCTIONS //-----------------------------------------------//

function startBattle() {
    // Si une seule musique reste et c'est la finale, afficher le vainqueur
    if (Round.length === 1) {
        afficherClassement();
        return;
    }

    // Si une seule musique reste dans un round impair, elle est qualifiée directement
    if (Round.length % 2 !== 0 && Historique.length === 0) {
        const lastMusique = Round.pop(); // Retirer la dernière musique du round
        console.log("Musique qualifiée automatiquement :", lastMusique.titre);
        ProchainRound.push(lastMusique);
    }

    // Obtenir des indices de musiques qui ne sont pas dans l'historique
    const indicesDisponibles = Round.map((_, i) => i).filter(i => !Historique.includes(i));

    // Si moins de deux musiques disponibles, passer au prochain round
    if (indicesDisponibles.length < 2) {
        Historique = []; // Réinitialiser l'historique pour le prochain round
        Round = [...ProchainRound];
        ProchainRound = [];
        startBattle();
        return;
    }

    // Sélectionner deux indices distincts
    const index1 = indicesDisponibles[Math.floor(Math.random() * indicesDisponibles.length)];
    let index2;
    do {
        index2 = indicesDisponibles[Math.floor(Math.random() * indicesDisponibles.length)];
    } while (index1 === index2);

    // Récupérer les musiques correspondantes
    const MUSIQUE1 = Round[index1];
    const MUSIQUE2 = Round[index2];

    // Afficher les musiques sélectionnées
    document.getElementById('CoverMusique1').src = MUSIQUE1.couverture;
    document.getElementById('titre1').textContent = MUSIQUE1.titre;

    document.getElementById('CoverMusique2').src = MUSIQUE2.couverture;
    document.getElementById('titre2').textContent = MUSIQUE2.titre;

    // Ajouter les indices sélectionnés à l'historique
    Historique.push(index1, index2);
}

function selectRound(titreSelectionne) {
    // Trouver et ajouter la musique sélectionnée au prochain round
    const musiqueSelectionnee = Round.find(m => m.titre === titreSelectionne);
    if (musiqueSelectionnee) {
        musiqueSelectionnee.points++; // Ajouter un point à la musique sélectionnée
        ProchainRound.push(musiqueSelectionnee);
    }

    // Démarrer le prochain duel si nécessaire
    if (Historique.length >= Round.length) {
        Historique = []; // Réinitialiser l'historique
        Round = [...ProchainRound];
        ProchainRound = [];
    }
    startBattle();
}

function afficherClassement() {
    // Trier les musiques par points décroissants
    const classement = MUSIQUES.sort((a, b) => b.points - a.points);

    // Modifier le texte pour annoncer le classement final
    document.querySelector("h1").textContent = "Classement Final !";
    document.querySelector("h2").textContent = "Voici la liste des musiques classées par vote :";

    // Afficher le classement final
    let classementHTML = "<ol>";
    classement.forEach(musique => {
        classementHTML += `<li>${musique.titre} - ${musique.points} points</li>`;
    });
    classementHTML += "</ol>";

    const divClassement = document.createElement("div");
    divClassement.innerHTML = classementHTML;
    document.body.appendChild(divClassement);

    // Cacher les images du BattleZone
    document.getElementById("BattleZone").style.display = "none";
}

//-----------------------------------------------// GESTION DOCUMENT //-----------------------------------------------//

document.addEventListener("DOMContentLoaded", () => {
    startBattle();
});

document.getElementById('CoverMusique1').addEventListener('click', function() {
    selectRound(document.getElementById('titre1').textContent);
});

document.getElementById('CoverMusique2').addEventListener('click', function() {
    selectRound(document.getElementById('titre2').textContent);
});
</script>

</html>
